import{d as F,j as M,r as x,c as V,w as q,a as f,b as n,e as s,g as r,u as a,k as H,C as L,i as p,h as k,f as l,t as _,o as g}from"./app-CdWJsdjD.js";import{_ as O}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dug9UArH.js";import{_ as Y}from"./PageHeader.vue_vue_type_script_setup_true_lang-CMEsGzwi.js";import{_ as G,a as J,b as K,c as Q}from"./VariantMatrix.vue_vue_type_script_setup_true_lang-NqdKQy7U.js";import{E as R,_ as v,a as b,b as w}from"./index-D4dNSDEJ.js";import{a as h,_ as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-Dv_0XedS.js";import{_ as $}from"./index-sDLcCfmY.js";import{A as W}from"./arrow-left-M2U0K44Y.js";import{P as X}from"./package-xfYG3Vt-.js";import"./Input.vue_vue_type_script_setup_true_lang-CvImpZJx.js";import"./index-DJvGgQ0r.js";import"./Separator.vue_vue_type_script_setup_true_lang-BwArgNY3.js";import"./heart-BdaRE3aN.js";import"./chevron-down-BxqV3mpS.js";import"./search-NPnSUXo7.js";import"./house-BQ0UKFGz.js";import"./chevron-right-BRnWapLW.js";import"./Textarea.vue_vue_type_script_setup_true_lang-Dtn4KViz.js";import"./Label.vue_vue_type_script_setup_true_lang-Dw-cLlbn.js";import"./useForwardExpose-DBYrSc0H.js";import"./upload-kVK_faoU.js";import"./star-Ce6pcYEi.js";import"./trash-2-BhVnhb-W.js";import"./plus-teeu78Bb.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BQT0AJ_2.js";import"./Presence-CWY0QQDo.js";import"./createContext-ApIAYh1H.js";import"./VisuallyHidden-BmnEWwTb.js";import"./check-J28NhSpr.js";import"./eye-off-BksRuq-v.js";import"./refresh-cw-D5ssntRV.js";const Z={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ee={class:"flex items-center justify-between"},te={class:"flex items-center gap-2 mt-2"},ae={key:0,class:"shrink-0"},ie=["src","alt"],oe={class:"text-sm text-muted-foreground"},se={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ne={class:"text-sm text-muted-foreground"},re={class:"text-sm text-muted-foreground"},le={class:"flex justify-between items-center pt-6"},de={class:"flex space-x-4"},ce={key:0,class:"flex items-center"},ue={key:1},Oe=F({__name:"Edit",props:{product:{type:Object,required:!0},categories:{type:Array,required:!0},existingVariants:{type:Array,default:()=>[]}},setup(t){const o=M({name_en:t.product.name_en||"",name_ar:t.product.name_ar||"",description_en:t.product.description_en||"",description_ar:t.product.description_ar||"",name:t.product.name,description:t.product.description,price:t.product.price,stock:t.product.stock,category_id:t.product.category_id,is_active:t.product.is_active,is_donatable:t.product.is_donatable,image:null,images:[],delete_images:[],primary_image_id:null,colors:[],sizes:[],variants:[]}),d=x(t.product.available_colors||[]),c=x(t.product.available_sizes||[]),u=x(t.existingVariants.map(e=>({id:e.id,color_id:e.color_id,size_id:e.size_id,color_name:e.color?.name||"Unknown",color_hex:e.color?.hex_code||"#000000",size_name:e.size?.name||"Unknown",stock:e.stock,price_adjustment:e.price_adjustment,is_active:e.is_active,sku:e.sku}))),P=V(()=>u.value.length>0),z=V(()=>t.existingVariants.length>0),E=[{label:"Back to Products",href:"/admin/products",icon:W,variant:"outline"},{label:"View Product",href:`/products/${t.product.slug}`,icon:R,variant:"outline"}];q([d,c],()=>{d.value.length>0&&c.value.length>0&&U()},{deep:!0});const U=()=>{const e=[];d.value.forEach(i=>{c.value.forEach(m=>{u.value.find(C=>C.color_id===i.id&&C.size_id===m.id)||e.push({color_id:i.id,size_id:m.id,color_name:i.name,color_hex:i.hex_code||i.hex,size_name:m.name,stock:0,price_adjustment:0,is_active:!0})})}),u.value=[...u.value,...e],u.value=u.value.filter(i=>d.value.some(m=>m.id===i.color_id)&&c.value.some(m=>m.id===i.size_id))},A=e=>{d.value=e,o.colors=e},j=e=>{c.value=e,o.sizes=e},N=e=>{u.value=e,o.variants=e},B=e=>{o.images=e,console.log("New images added to form:",e.length,e)},I=e=>{o.delete_images||(o.delete_images=[]),o.delete_images.push(e),console.log("Image marked for deletion:",e)},S=e=>{o.primary_image_id=e,console.log("Primary image set to:",e)},D=()=>{console.log("Form data before submit:",{name:o.name,price:o.price,stock:o.stock,category_id:o.category_id,is_active:o.is_active,is_donatable:o.is_donatable,has_single_image:!!o.image,has_multiple_images:o.images&&o.images.length>0,images_count:o.images?.length||0,delete_images_count:o.delete_images?.length||0,primary_image_id:o.primary_image_id}),o.transform(e=>({...e,_method:"PATCH",is_active:e.is_active?1:0,is_donatable:e.is_donatable?1:0})).post(`/admin/products/${t.product.id}`,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{console.log("Update successful")},onError:e=>{console.log("Update errors:",e),window.scrollTo({top:0,behavior:"smooth"})}})},T=()=>{confirm("Are you sure you want to delete this product? This action cannot be undone.")&&o.delete(`/admin/products/${t.product.id}`)};return(e,i)=>(g(),f(O,{title:"Edit Product"},{default:n(()=>[s(a(H),{title:`Edit ${t.product.name}`},null,8,["title"]),s(Y,{title:`Edit Product: ${t.product.name}`,description:"Update product information and manage variants",icon:a(X),"icon-color":"text-primary",actions:E},null,8,["title","icon"]),r("div",Z,[r("form",{onSubmit:L(D,["prevent"]),class:"space-y-8"},[s(a(v),null,{default:n(()=>[s(a(h),null,{default:n(()=>[r("div",ee,[r("div",null,[s(a(y),null,{default:n(()=>[...i[1]||(i[1]=[l("Basic Product Information",-1)])]),_:1}),r("div",te,[s(a($),{variant:t.product.is_active?"secondary":"destructive"},{default:n(()=>[l(_(t.product.is_active?"Active":"Inactive"),1)]),_:1},8,["variant"]),t.product.is_donatable?(g(),f(a($),{key:0,variant:"primary"},{default:n(()=>[...i[2]||(i[2]=[l(" Donatable ",-1)])]),_:1})):p("",!0),t.product.images&&t.product.images.length>0?(g(),f(a($),{key:1,variant:"outline"},{default:n(()=>[l(_(t.product.images.length)+" Images ",1)]),_:1})):p("",!0)])]),t.product.image_url||t.product.image?(g(),k("div",ae,[r("img",{src:t.product.image_url||t.product.image,alt:t.product.name,class:"w-20 h-20 object-cover rounded-lg border"},null,8,ie)])):p("",!0)])]),_:1}),s(a(b),null,{default:n(()=>[s(G,{form:a(o),categories:t.categories,images:t.product.images||[],onImagesChange:B,onDeleteImage:I,onSetPrimaryImage:S},null,8,["form","categories","images"])]),_:1})]),_:1}),z.value?(g(),f(a(v),{key:0},{default:n(()=>[s(a(h),null,{default:n(()=>[s(a(y),null,{default:n(()=>[...i[3]||(i[3]=[l("Current Variants",-1)])]),_:1}),r("p",oe," This product has "+_(t.existingVariants.length)+" existing variants. You can modify them below or add new color/size combinations. ",1)]),_:1})]),_:1})):p("",!0),r("div",se,[s(a(v),null,{default:n(()=>[s(a(h),null,{default:n(()=>[s(a(y),null,{default:n(()=>[...i[4]||(i[4]=[l("Colors",-1)])]),_:1}),r("p",ne,_(d.value.length>0?`${d.value.length} colors selected`:"No colors selected"),1)]),_:1}),s(a(b),null,{default:n(()=>[s(J,{colors:d.value,"onUpdate:colors":A},null,8,["colors"])]),_:1})]),_:1}),s(a(v),null,{default:n(()=>[s(a(h),null,{default:n(()=>[s(a(y),null,{default:n(()=>[...i[5]||(i[5]=[l("Sizes",-1)])]),_:1}),r("p",re,_(c.value.length>0?`${c.value.length} sizes selected`:"No sizes selected"),1)]),_:1}),s(a(b),null,{default:n(()=>[s(K,{sizes:c.value,"onUpdate:sizes":j},null,8,["sizes"])]),_:1})]),_:1})]),P.value||z.value?(g(),f(a(v),{key:1},{default:n(()=>[s(a(h),null,{default:n(()=>[s(a(y),null,{default:n(()=>[...i[6]||(i[6]=[l("Product Variants Management",-1)])]),_:1}),i[7]||(i[7]=r("p",{class:"text-sm text-muted-foreground"}," Configure stock, pricing, and availability for each variant ",-1))]),_:1}),s(a(b),null,{default:n(()=>[s(Q,{variants:u.value,"base-price":a(o).price,"onUpdate:variants":N},null,8,["variants","base-price"])]),_:1})]),_:1})):p("",!0),r("div",le,[s(a(w),{type:"button",variant:"destructive",onClick:T,disabled:a(o).processing},{default:n(()=>[...i[8]||(i[8]=[l(" Delete Product ",-1)])]),_:1},8,["disabled"]),r("div",de,[s(a(w),{type:"button",variant:"outline",disabled:a(o).processing,onClick:i[0]||(i[0]=m=>e.$inertia.visit("/admin/products"))},{default:n(()=>[...i[9]||(i[9]=[l(" Cancel ",-1)])]),_:1},8,["disabled"]),s(a(w),{type:"submit",disabled:a(o).processing,class:"min-w-[120px]"},{default:n(()=>[a(o).processing?(g(),k("div",ce,[...i[10]||(i[10]=[r("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),l(" Updating... ",-1)])])):(g(),k("span",ue,"Update Product"))]),_:1},8,["disabled"])])])],32)])]),_:1}))}});export{Oe as default};
