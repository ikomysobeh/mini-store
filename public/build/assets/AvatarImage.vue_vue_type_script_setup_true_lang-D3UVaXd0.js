import{u as C}from"./useForwardExpose-DfRgSPHl.js";import{i as S,P as L}from"./index-1wb7NqwU.js";import{i as w}from"./AvatarFallback.vue_vue_type_script_setup_true_lang-CzDr19WN.js";import{r as f,c as E,G as I,K as q,H as P,d as p,V as A,w as B,m as x,C as O,u,a as g,b as _,I as h,o as y,U as R}from"./app-BIsdkUFR.js";function m(a,r){return a?r?(a.src!==r&&(a.src=r),a.complete&&a.naturalWidth>0?"loaded":"loading"):"error":"idle"}function k(a,{referrerPolicy:r,crossOrigin:s}={}){const t=f(!1),o=f(null),i=E(()=>t.value?(!o.value&&S&&(o.value=new window.Image),o.value):null),l=f(m(i.value,a.value)),d=n=>()=>{t.value&&(l.value=n)};return I(()=>{t.value=!0,q(n=>{const e=i.value;if(!e)return;l.value=m(e,a.value);const c=d("loaded"),v=d("error");e.addEventListener("load",c),e.addEventListener("error",v),r?.value&&(e.referrerPolicy=r.value),typeof s?.value=="string"&&(e.crossOrigin=s.value),n(()=>{e.removeEventListener("load",c),e.removeEventListener("error",v)})})}),P(()=>{t.value=!1}),l}var M=p({__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},crossOrigin:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"img"}},emits:["loadingStatusChange"],setup(a,{emit:r}){const s=a,t=r,{src:o,referrerPolicy:i,crossOrigin:l}=A(s);C();const d=w(),n=k(o,{referrerPolicy:i,crossOrigin:l});return B(n,e=>{t("loadingStatusChange",e),e!=="idle"&&(d.imageLoadingStatus.value=e)},{immediate:!0}),(e,c)=>x((y(),g(u(L),{role:"img","as-child":e.asChild,as:e.as,src:u(o),"referrer-policy":u(i)},{default:_(()=>[h(e.$slots,"default")]),_:3},8,["as-child","as","src","referrer-policy"])),[[O,u(n)==="loaded"]])}}),U=M;const D=p({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{}},setup(a){const r=a;return(s,t)=>(y(),g(u(U),R({"data-slot":"avatar-image"},r,{class:"aspect-square size-full"}),{default:_(()=>[h(s.$slots,"default")]),_:3},16))}});export{D as _};
