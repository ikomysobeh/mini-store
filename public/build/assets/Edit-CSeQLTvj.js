import{d as F,j as M,r as x,c as V,w as q,a as f,b as l,e as o,g as n,u as t,k as H,z as L,i as p,h as k,f as r,t as _,o as g}from"./app-IjquBGq5.js";import{_ as O}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BPUU8q0a.js";import{_ as Y}from"./PageHeader.vue_vue_type_script_setup_true_lang-ClYpggu0.js";import{_ as G,a as J,b as K,c as Q}from"./VariantMatrix.vue_vue_type_script_setup_true_lang-DCvqrVe3.js";import{_ as v,a as b,b as w}from"./index-wgz8HuGA.js";import{a as h,_ as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-D4L4mGDM.js";import{_ as $}from"./index-CrF-XWYa.js";import{A as R}from"./arrow-left-BjB31dq0.js";import{E as W}from"./eye-C61y-rjM.js";import{P as X}from"./package-DUwp68L2.js";import"./Input.vue_vue_type_script_setup_true_lang-DIY4W62R.js";import"./Separator.vue_vue_type_script_setup_true_lang-D20f8Leo.js";import"./heart-DUjCBcq6.js";import"./chevron-down-bm_mI4_A.js";import"./search-vgvliSao.js";import"./house-DtH66wnt.js";import"./users-DEfFURPp.js";import"./chevron-right-DEy2yTqc.js";import"./Textarea.vue_vue_type_script_setup_true_lang-CnwW8l8m.js";import"./Label.vue_vue_type_script_setup_true_lang-BMJKSjMc.js";import"./useForwardExpose-DQEUKRDa.js";import"./star-jICqu20R.js";import"./trash-2-DtnqSkHC.js";import"./plus-Bn0vCB5b.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-B5Ycgwjp.js";import"./createContext-DJ76W1Ox.js";import"./eye-off-Bp_-j-ci.js";import"./refresh-cw-C-4GPGLS.js";const Z={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ee={class:"flex items-center justify-between"},te={class:"flex items-center gap-2 mt-2"},ae={key:0,class:"shrink-0"},ie=["src","alt"],se={class:"text-sm text-muted-foreground"},oe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},le={class:"text-sm text-muted-foreground"},ne={class:"text-sm text-muted-foreground"},re={class:"flex justify-between items-center pt-6"},de={class:"flex space-x-4"},ce={key:0,class:"flex items-center"},ue={key:1},qe=F({__name:"Edit",props:{product:{type:Object,required:!0},categories:{type:Array,required:!0},existingVariants:{type:Array,default:()=>[]}},setup(i){const s=M({name:i.product.name,description:i.product.description,price:i.product.price,stock:i.product.stock,category_id:i.product.category_id,is_active:i.product.is_active,is_donatable:i.product.is_donatable,image:null,images:[],delete_images:[],primary_image_id:null,colors:[],sizes:[],variants:[]}),d=x(i.product.available_colors||[]),c=x(i.product.available_sizes||[]),u=x(i.existingVariants.map(e=>({id:e.id,color_id:e.color_id,size_id:e.size_id,color_name:e.color?.name||"Unknown",color_hex:e.color?.hex_code||"#000000",size_name:e.size?.name||"Unknown",stock:e.stock,price_adjustment:e.price_adjustment,is_active:e.is_active,sku:e.sku}))),P=V(()=>u.value.length>0),z=V(()=>i.existingVariants.length>0),E=[{label:"Back to Products",href:"/admin/products",icon:R,variant:"outline"},{label:"View Product",href:`/products/${i.product.slug}`,icon:W,variant:"outline"}];q([d,c],()=>{d.value.length>0&&c.value.length>0&&U()},{deep:!0});const U=()=>{const e=[];d.value.forEach(a=>{c.value.forEach(m=>{u.value.find(C=>C.color_id===a.id&&C.size_id===m.id)||e.push({color_id:a.id,size_id:m.id,color_name:a.name,color_hex:a.hex_code||a.hex,size_name:m.name,stock:0,price_adjustment:0,is_active:!0})})}),u.value=[...u.value,...e],u.value=u.value.filter(a=>d.value.some(m=>m.id===a.color_id)&&c.value.some(m=>m.id===a.size_id))},A=e=>{d.value=e,s.colors=e},j=e=>{c.value=e,s.sizes=e},N=e=>{u.value=e,s.variants=e},B=e=>{s.images=e,console.log("New images added to form:",e.length,e)},I=e=>{s.delete_images||(s.delete_images=[]),s.delete_images.push(e),console.log("Image marked for deletion:",e)},S=e=>{s.primary_image_id=e,console.log("Primary image set to:",e)},D=()=>{console.log("Form data before submit:",{name:s.name,price:s.price,stock:s.stock,category_id:s.category_id,is_active:s.is_active,is_donatable:s.is_donatable,has_single_image:!!s.image,has_multiple_images:s.images&&s.images.length>0,images_count:s.images?.length||0,delete_images_count:s.delete_images?.length||0,primary_image_id:s.primary_image_id}),s.transform(e=>({...e,_method:"PATCH",is_active:e.is_active?1:0,is_donatable:e.is_donatable?1:0})).post(`/admin/products/${i.product.id}`,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{console.log("Update successful")},onError:e=>{console.log("Update errors:",e),window.scrollTo({top:0,behavior:"smooth"})}})},T=()=>{confirm("Are you sure you want to delete this product? This action cannot be undone.")&&s.delete(`/admin/products/${i.product.id}`)};return(e,a)=>(g(),f(O,{title:"Edit Product"},{default:l(()=>[o(t(H),{title:`Edit ${i.product.name}`},null,8,["title"]),o(Y,{title:`Edit Product: ${i.product.name}`,description:"Update product information and manage variants",icon:t(X),"icon-color":"text-primary",actions:E},null,8,["title","icon"]),n("div",Z,[n("form",{onSubmit:L(D,["prevent"]),class:"space-y-8"},[o(t(v),null,{default:l(()=>[o(t(h),null,{default:l(()=>[n("div",ee,[n("div",null,[o(t(y),null,{default:l(()=>[...a[1]||(a[1]=[r("Basic Product Information",-1)])]),_:1}),n("div",te,[o(t($),{variant:i.product.is_active?"secondary":"destructive"},{default:l(()=>[r(_(i.product.is_active?"Active":"Inactive"),1)]),_:1},8,["variant"]),i.product.is_donatable?(g(),f(t($),{key:0,variant:"primary"},{default:l(()=>[...a[2]||(a[2]=[r(" Donatable ",-1)])]),_:1})):p("",!0),i.product.images&&i.product.images.length>0?(g(),f(t($),{key:1,variant:"outline"},{default:l(()=>[r(_(i.product.images.length)+" Images ",1)]),_:1})):p("",!0)])]),i.product.image_url||i.product.image?(g(),k("div",ae,[n("img",{src:i.product.image_url||i.product.image,alt:i.product.name,class:"w-20 h-20 object-cover rounded-lg border"},null,8,ie)])):p("",!0)])]),_:1}),o(t(b),null,{default:l(()=>[o(G,{form:t(s),categories:i.categories,images:i.product.images||[],onImagesChange:B,onDeleteImage:I,onSetPrimaryImage:S},null,8,["form","categories","images"])]),_:1})]),_:1}),z.value?(g(),f(t(v),{key:0},{default:l(()=>[o(t(h),null,{default:l(()=>[o(t(y),null,{default:l(()=>[...a[3]||(a[3]=[r("Current Variants",-1)])]),_:1}),n("p",se," This product has "+_(i.existingVariants.length)+" existing variants. You can modify them below or add new color/size combinations. ",1)]),_:1})]),_:1})):p("",!0),n("div",oe,[o(t(v),null,{default:l(()=>[o(t(h),null,{default:l(()=>[o(t(y),null,{default:l(()=>[...a[4]||(a[4]=[r("Colors",-1)])]),_:1}),n("p",le,_(d.value.length>0?`${d.value.length} colors selected`:"No colors selected"),1)]),_:1}),o(t(b),null,{default:l(()=>[o(J,{colors:d.value,"onUpdate:colors":A},null,8,["colors"])]),_:1})]),_:1}),o(t(v),null,{default:l(()=>[o(t(h),null,{default:l(()=>[o(t(y),null,{default:l(()=>[...a[5]||(a[5]=[r("Sizes",-1)])]),_:1}),n("p",ne,_(c.value.length>0?`${c.value.length} sizes selected`:"No sizes selected"),1)]),_:1}),o(t(b),null,{default:l(()=>[o(K,{sizes:c.value,"onUpdate:sizes":j},null,8,["sizes"])]),_:1})]),_:1})]),P.value||z.value?(g(),f(t(v),{key:1},{default:l(()=>[o(t(h),null,{default:l(()=>[o(t(y),null,{default:l(()=>[...a[6]||(a[6]=[r("Product Variants Management",-1)])]),_:1}),a[7]||(a[7]=n("p",{class:"text-sm text-muted-foreground"}," Configure stock, pricing, and availability for each variant ",-1))]),_:1}),o(t(b),null,{default:l(()=>[o(Q,{variants:u.value,"base-price":t(s).price,"onUpdate:variants":N},null,8,["variants","base-price"])]),_:1})]),_:1})):p("",!0),n("div",re,[o(t(w),{type:"button",variant:"destructive",onClick:T,disabled:t(s).processing},{default:l(()=>[...a[8]||(a[8]=[r(" Delete Product ",-1)])]),_:1},8,["disabled"]),n("div",de,[o(t(w),{type:"button",variant:"outline",disabled:t(s).processing,onClick:a[0]||(a[0]=m=>e.$inertia.visit("/admin/products"))},{default:l(()=>[...a[9]||(a[9]=[r(" Cancel ",-1)])]),_:1},8,["disabled"]),o(t(w),{type:"submit",disabled:t(s).processing,class:"min-w-[120px]"},{default:l(()=>[t(s).processing?(g(),k("div",ce,[...a[10]||(a[10]=[n("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24"},[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),r(" Updating... ",-1)])])):(g(),k("span",ue,"Update Product"))]),_:1},8,["disabled"])])])],32)])]),_:1}))}});export{qe as default};
