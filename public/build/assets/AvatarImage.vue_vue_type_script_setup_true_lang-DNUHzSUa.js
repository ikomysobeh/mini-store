import{u as S}from"./useForwardExpose-QaTcUrh8.js";import{i as C,P as L}from"./index-BkCac0jj.js";import{i as w}from"./AvatarFallback.vue_vue_type_script_setup_true_lang-BWd9wGrz.js";import{r as f,c as E,G as q,O as A,H as I,d as p,K as P,w as B,m as O,_ as x,u,a as g,b as _,z as h,o as y,A as R}from"./app-yiE6uSpj.js";function m(a,r){return a?r?(a.src!==r&&(a.src=r),a.complete&&a.naturalWidth>0?"loaded":"loading"):"error":"idle"}function k(a,{referrerPolicy:r,crossOrigin:s}={}){const t=f(!1),o=f(null),i=E(()=>t.value?(!o.value&&C&&(o.value=new window.Image),o.value):null),l=f(m(i.value,a.value)),d=n=>()=>{t.value&&(l.value=n)};return q(()=>{t.value=!0,A(n=>{const e=i.value;if(!e)return;l.value=m(e,a.value);const c=d("loaded"),v=d("error");e.addEventListener("load",c),e.addEventListener("error",v),r?.value&&(e.referrerPolicy=r.value),typeof s?.value=="string"&&(e.crossOrigin=s.value),n(()=>{e.removeEventListener("load",c),e.removeEventListener("error",v)})})}),I(()=>{t.value=!1}),l}var z=p({__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},crossOrigin:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"img"}},emits:["loadingStatusChange"],setup(a,{emit:r}){const s=a,t=r,{src:o,referrerPolicy:i,crossOrigin:l}=P(s);S();const d=w(),n=k(o,{referrerPolicy:i,crossOrigin:l});return B(n,e=>{t("loadingStatusChange",e),e!=="idle"&&(d.imageLoadingStatus.value=e)},{immediate:!0}),(e,c)=>O((y(),g(u(L),{role:"img","as-child":e.asChild,as:e.as,src:u(o),"referrer-policy":u(i)},{default:_(()=>[h(e.$slots,"default")]),_:3},8,["as-child","as","src","referrer-policy"])),[[x,u(n)==="loaded"]])}}),M=z;const F=p({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{}},setup(a){const r=a;return(s,t)=>(y(),g(u(M),R({"data-slot":"avatar-image"},r,{class:"aspect-square size-full"}),{default:_(()=>[h(s.$slots,"default")]),_:3},16))}});export{F as _};
